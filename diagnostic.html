<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dept56 Diagnostic Page</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            background: #f5f5f5;
        }
        .card {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #dc2626;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
        }
        .status.ok {
            background: #dcfce7;
            color: #166534;
        }
        .status.error {
            background: #fee2e2;
            color: #991b1b;
        }
        .info {
            font-size: 14px;
            line-height: 1.8;
        }
        button {
            background: #dc2626;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #b91c1c;
        }
        #results {
            white-space: pre-wrap;
            font-family: monospace;
            background: #f9fafb;
            padding: 15px;
            border-radius: 4px;
            font-size: 12px;
            max-height: 400px;
            overflow: auto;
        }
    </style>
</head>
<body>
    <h1>üè† Dept56 Gallery Diagnostic Tool</h1>
    
    <div class="card">
        <h2>Browser Information</h2>
        <div class="info">
            <div><strong>User Agent:</strong> <span id="userAgent"></span></div>
            <div><strong>Platform:</strong> <span id="platform"></span></div>
            <div><strong>Screen Size:</strong> <span id="screenSize"></span></div>
            <div><strong>Online:</strong> <span id="online"></span></div>
            <div><strong>Connection Type:</strong> <span id="connection"></span></div>
        </div>
    </div>

    <div class="card">
        <h2>Network Tests</h2>
        <button onclick="testSupabaseConnection()">Test Supabase Connection</button>
        <button onclick="testDNS()">Test DNS Resolution</button>
        <button onclick="testCORS()">Test CORS</button>
        <div id="results" style="margin-top: 15px;"></div>
    </div>

    <div class="card">
        <h2>Quick Actions</h2>
        <button onclick="clearCache()">Clear Cache & Reload</button>
        <button onclick="window.location.href='/'">Go to Main App</button>
    </div>

    <script type="module">
        // Display browser info
        document.getElementById('userAgent').textContent = navigator.userAgent;
        document.getElementById('platform').textContent = navigator.platform;
        document.getElementById('screenSize').textContent = `${window.innerWidth}x${window.innerHeight}`;
        document.getElementById('online').textContent = navigator.onLine ? '‚úÖ Online' : '‚ùå Offline';
        
        const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
        document.getElementById('connection').textContent = connection ? 
            `${connection.effectiveType || 'unknown'} (${connection.downlink || '?'} Mbps)` : 
            'Unknown';

        // Test functions
        window.testSupabaseConnection = async function() {
            const results = document.getElementById('results');
            results.textContent = 'Testing Supabase connection...\n\n';
            
            try {
                // Import env vars
                const SUPABASE_URL = 'https://xctottgirqkkmjmutoon.supabase.co';
                const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhjdG90dGdpcnFra21qbXV0b29uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1NTQ5ODUsImV4cCI6MjA3NjEzMDk4NX0.ioIkzka-s1N5UKH8Ds8ZXug6CUT6vVXH4_00G9XuoJI';
                
                results.textContent += `‚úÖ Environment variables loaded\n`;
                results.textContent += `   URL: ${SUPABASE_URL}\n`;
                results.textContent += `   Key: ${SUPABASE_KEY ? 'Present' : 'MISSING'}\n\n`;
                
                // Test basic connection
                results.textContent += 'Testing basic HTTP connection...\n';
                const response = await fetch(SUPABASE_URL + '/rest/v1/', {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                results.textContent += `‚úÖ HTTP Status: ${response.status} ${response.statusText}\n\n`;
                
                // Test houses table
                results.textContent += 'Testing houses table query...\n';
                const housesResponse = await fetch(SUPABASE_URL + '/rest/v1/houses?limit=1', {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    }
                });
                
                if (housesResponse.ok) {
                    const data = await housesResponse.json();
                    results.textContent += `‚úÖ Houses table accessible (${data.length} rows returned)\n`;
                } else {
                    results.textContent += `‚ùå Houses table error: ${housesResponse.status}\n`;
                }
                
                results.textContent += '\n‚úÖ All tests passed! Supabase is accessible from this device.\n';
                
            } catch (error) {
                results.textContent += `\n‚ùå ERROR: ${error.message}\n`;
                results.textContent += `\nStack trace:\n${error.stack}\n`;
            }
        };

        window.testDNS = async function() {
            const results = document.getElementById('results');
            results.textContent = 'Testing DNS resolution...\n\n';
            
            const domains = [
                'xctottgirqkkmjmutoon.supabase.co',
                'dept56.rndpig.com',
                'www.rndpig.com'
            ];
            
            for (const domain of domains) {
                try {
                    const start = Date.now();
                    const response = await fetch(`https://${domain}/`, { method: 'HEAD', mode: 'no-cors' });
                    const time = Date.now() - start;
                    results.textContent += `‚úÖ ${domain} - Resolved in ${time}ms\n`;
                } catch (error) {
                    results.textContent += `‚ùå ${domain} - Failed: ${error.message}\n`;
                }
            }
        };

        window.testCORS = async function() {
            const results = document.getElementById('results');
            results.textContent = 'Testing CORS policies...\n\n';
            
            try {
                const response = await fetch('https://xctottgirqkkmjmutoon.supabase.co/rest/v1/houses?limit=1', {
                    headers: {
                        'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhjdG90dGdpcnFra21qbXV0b29uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1NTQ5ODUsImV4cCI6MjA3NjEzMDk4NX0.ioIkzka-s1N5UKH8Ds8ZXug6CUT6vVXH4_00G9XuoJI'
                    }
                });
                
                results.textContent += `‚úÖ CORS headers present\n`;
                results.textContent += `   Access-Control-Allow-Origin: ${response.headers.get('access-control-allow-origin')}\n`;
                results.textContent += `   Status: ${response.status}\n`;
            } catch (error) {
                results.textContent += `‚ùå CORS error: ${error.message}\n`;
            }
        };

        window.clearCache = function() {
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => caches.delete(name));
                });
            }
            localStorage.clear();
            sessionStorage.clear();
            alert('Cache cleared! Reloading...');
            window.location.reload(true);
        };
    </script>
</body>
</html>
